<!-- Authors: Nate Stone and Mika Lorenzen
Mika's Notes: Currently, I have 5 sets of clickable polygons. The first covers the grid on the left, the second covers
the drills on the map on the right, the third covers the scoops on the map on the right, the fourth covers the drill
and scoop site parts of the key, and the fifth covers the locations on the map on the right.
As those sets stand, Oudam and Rocknest have spotty behavior because they each have two entries on CheMin (Oudam 12a,
Oudam 13a, Rocknest (4th Scoop), Rocknest (5th Scoop). Additionally, the fifth set for the locations is empty because
I am unsure how would be best to include them. Also, the fourth set's data voices my concern that maybe a different
format of popover could be used in this webpage based on the need for it (see "Drill Site" or "Scoop Site" on the
webpage to see what I mean here)? -->

<html>
<head>
<link rel="stylesheet" href="node_modules/MapifyCustom/build/jquery.mapify.css">
<script src="node_modules/jquery/dist/jquery.min.js"></script>
<script src="node_modules/MapifyCustom/src/mapify.js"></script>
<script>
jQuery(function() {
    $("img[usemap]").mapify({
        popOver: {
            content: function(zone){ 
                // Build the content for the popOver
                var data = zone.attr("data-zone").split(/\|/);
                var data_html = "<ul>";
                data_html += "<li><b>Mars Area Location:</b> " + data[0] + "</li>";
                data_html += "<li><b>Site Position:</b> " + data[1] + "</li>";
                data_html += "<li><b>Distance to Bradbury (m):</b> " + data[2] + "</li>";
                data_html += "</ul>";
                return "<strong>" + zone.attr("data-title") + "</strong>" + data_html;
            },
            delay: 0.7,
            margin: "15px",
            height: "130px",
            width: "260px"
        }
    })
       
    // Prevent clicks on the mapify polygons
    $(".mapify-svg polygon").click(function(e) {
        e.preventDefault()
    })

    // Add click listener for the Map Areas
    $(".clickable").click(function(e) {
        e.preventDefault()
        // Get index
        // Highlight index in svg
        $(".mapify-svg polygon:nth-child(" + ($(this).index()*1 + 1) + ")").toggleClass("mapify-selected")

        // Show "search" button if selected > 1
        if($(".mapify-selected").length >= 1) {
            var base_url = "http://odr.io/chemin#/search/render/dt_id=43|gen="
            var search_link = "<div class='search-link'><a target='_blank' href='" + base_url;

            // Get selected names separated by pipes
            var search_string = "";
            $(".mapify-svg").find(".mapify-selected").each(function() {
                var search_term = $(".clickable:nth-child(" + ($(this).index() + 1) + ")").attr("data-searchterm")
                search_string += '"' + search_term + '" || '
            })
            search_string = search_string.replace(/\s\|\|\s$/,'')

            //Makes the string compatible with the browser
            search_link += encodeURIComponent(search_string) + "/1'>Click to search</a></div>"
            console.log(search_link)

            $("#search-link").html(search_link)
            
            $("#search-link").show()
        }
        else {
            $("#search-link").html("")
            $("#search-link").hide()
        }
    })
})
</script>

<style>
    .mapify-hover {
        opacity: 0.5;
    }

    .mapify-selected {
        fill: #0f0;	
        opacity: 0.5;
    }

    #search-link {
        display: none;
        background: rgba(255,255,255,0.9);
        border: 2px solid rgb(0,0,255,0.7);
        border-radius: 8px;
        position: absolute;
        min-width: 200px;
        right: 15px;
        top: 15px;
        z-index: 100;
        padding: 8px;
    }

    #search-link a {
        text-decoration: none;
        margin-left: 50px;
        margin-right: 50px;
        font-size: 24px;
        font-family: sans;
        font-weight: 400;
    }

    .mapify-popOver {
        padding: 16px 10px 10px 10px;
    }
    .mapify-popOver strong {
        font-size: 18px;
    }
    .mapify-popOver-content ul {
        list-style-type: none;
    }
    .mapify-popOver-content ul li {
        margin-left: -50px;
    }
</style>
</head>
<body>
<img src="images/msl-drill-targets-sol1495-pia21254-full.jpg" width="3300" height="2550" border="0" usemap="#Map" />
<!-- The map MUST use polygons only due to the Mapify Plugin -->
<map name="Map" id="Map">
    //The following set is for the grid on the left side of the image
    <area class="clickable" data-zone="Yellowknife Bay|6_0|444.81" href="#" shape="poly" coords="87,7,688,7,688,450,87,450,87,7" data-title="John Klein" data-searchterm="john klein">
    <area class="clickable" data-zone="Pahrump Hills|42_1020|0.02 (Accurate?)" href="#" shape="poly" coords="87,458,688,458,688,902,87,902,87,458" data-title="Confidence Hills" data-searchterm="confidence hills">
    <area class="clickable" data-zone="Marias Pass|48_2542|6289.82" href="#" shape="poly" coords="87,904,688,904,688,1352,87,1352,87,904" data-title="Buckskin" data-searchterm="buckskin">
    <area class="clickable" data-zone="Naukluft Plateau|54_746|7180.29" href="#" shape="poly" coords="87,1348,688,1348,688,1802,87,1802,87,1348" data-title="Lubango" data-searchterm="lubango">
    <area class="clickable" data-zone="Murray Buttes|56_1236|7761.45" href="#" shape="poly" coords="87,1800,688,1800,688,2242,87,2242,87,1800" data-title="Marimba" data-searchterm="marimba2">
    <area class="clickable" data-zone="Yellowknife Bay|6_82|443.34" href="#" shape="poly" coords="689,7,1290,7,1290,450,689,450,689,7" data-title="Cumberland" data-searchterm="cumberland">
    <area class="clickable" data-zone="Pahrump Hills|45_0|2.15 (Accurate?)" href="#" shape="poly" coords="689,458,1290,458,1290,902,689,902,689,458" data-title="Mojave" data-searchterm="mojave2">
    <area class="clickable" data-zone="Bridger Basin|50_676|6581.66" href="#" shape="poly" coords="689,904,1290,904,1290,1352,689,1352,689,904" data-title="Big Sky" data-searchterm="big sky">
    <area class="clickable" data-zone="Naukluft Plateau|54_938|7178.77" href="#" shape="poly" coords="689,1348,1290,1348,1290,1802,689,1802,689,1348" data-title="Okoruso" data-searchterm="okoruso">
    <area class="clickable" data-zone="Murray Buttes|57_2798|8177.89" href="#" shape="poly" coords="689,1800,1290,1800,1290,2242,689,2242,689,1800" data-title="Quela" data-searchterm="quela">
    <area class="clickable" data-zone="Kimberley|31_1330|0.02 (Accurate?)" href="#" shape="poly" coords="1291,7,1886,7,1886,450,1291,450,1291,7" data-title="Windjana" data-searchterm="windjana">
    <area class="clickable" data-zone="Pahrump Hills|45_450|0.02 (Accurate?)" href="#" shape="poly" coords="1291,458,1886,458,1886,902,1291,902,1291,458" data-title="Telegraph Peak" data-searchterm="telegraph peak">
    <area class="clickable" data-zone="Bridger Basin|50_676|6581.66" href="#" shape="poly" coords="1291,904,1886,904,1886,1352,1291,1352,1291,904" data-title="Greenhorn" data-searchterm="greenhorn">
    <area class="clickable" data-zone="Naukluft Plateau|54_2280|7259.87" href="#" shape="poly" coords="1291,1348,1886,1348,1886,1802,1291,1802,1291,1348" data-title="Oudam" data-searchterm="oudam">
    <area class="clickable" data-zone="Murray Buttes|58_2046|8307.80" href="#" shape="poly" coords="1291,1800,1886,1800,1886,2242,1291,2242,1291,1800" data-title="Sebina" data-searchterm="sebina">

    //The following sets are for the travel map on the right side of the image
    //This second set matches exactly to the analyses in the grid on the left
    <area class="clickable" data-zone="Yellowknife Bay|6_0|444.81" href="#" shape="poly" coords="2200,350,2460,350,2460,400,2200,400,2200,350" data-title="John Klein" data-searchterm="john klein">
    <area class="clickable" data-zone="Pahrump Hills|42_1020|0.02 (Accurate?)" href="#" shape="poly" coords="2120,1760,2520,1760,2520,1815,2120,1815,2120,1760" data-title="Confidence Hills" data-searchterm="confidence hills">
    <area class="clickable" data-zone="Marias Pass|48_2542|6289.82" href="#" shape="poly" coords="2300,1970,2525,1970,2525,2020,2300,2020,2300,1970" data-title="Buckskin" data-searchterm="buckskin">
    <area class="clickable" data-zone="Naukluft Plateau|54_746|7180.29" href="#" shape="poly" coords="2285,2300,2500,2300,2500,2355,2285,2355,2285,2300" data-title="Lubango" data-searchterm="lubango">
    <area class="clickable" data-zone="Murray Buttes|56_1236|7761.45" href="#" shape="poly" coords="2340,2360,2550,2360,2550,2405,2340,2405,2340,2360" data-title="Marimba" data-searchterm="marimba2">
    <area class="clickable" data-zone="Yellowknife Bay|6_82|443.34" href="#" shape="poly" coords="2160,405,2460,405,2460,455,2160,455,2160,405" data-title="Cumberland" data-searchterm="cumberland">
    <area class="clickable" data-zone="Pahrump Hills|45_0|2.15 (Accurate?)" href="#" shape="poly" coords="2340,1820,2520,1820,2520,1875,2340,1875,2340,1820" data-title="Mojave" data-searchterm="mojave2">
    <area class="clickable" data-zone="Bridger Basin|50_676|6581.66" href="#" shape="poly" coords="2325,2055,2515,2055,2515,2110,2325,2110,2325,2055" data-title="Big Sky" data-searchterm="big sky">
    <area class="clickable" data-zone="Naukluft Plateau|54_938|7178.77" href="#" shape="poly" coords="2290,2180,2505,2180,2505,2230,2290,2230,2290,2180" data-title="Okoruso" data-searchterm="okoruso">
    <area class="clickable" data-zone="Murray Buttes|57_2798|8177.89" href="#" shape="poly" coords="2470,2460,2620,2460,2620,2510,2470,2510,2470,2460" data-title="Quela" data-searchterm="quela">
    <area class="clickable" data-zone="Kimberley|31_1330|0.02 (Accurate?)" href="#" shape="poly" coords="2310,1370,2545,1370,2545,1425,2310,1425,2310,1370" data-title="Windjana" data-searchterm="windjana">
    <area class="clickable" data-zone="Pahrump Hills|45_450|0.02 (Accurate?)" href="#" shape="poly" coords="2145,1880,2520,1880,2520,1940,2145,1940,2145,1880" data-title="Telegraph Peak" data-searchterm="telegraph peak">
    <area class="clickable" data-zone="Bridger Basin|50_676|6581.66" href="#" shape="poly" coords="2250,2110,2510,2110,2510,2160,2250,2160,2250,2110" data-title="Greenhorn" data-searchterm="greenhorn">
    <area class="clickable" data-zone="Naukluft Plateau|54_2280|7259.87" href="#" shape="poly" coords="2325,2240,2505,2240,2505,2290,2325,2290,2325,2240" data-title="Oudam" data-searchterm="oudam">
    <area class="clickable" data-zone="Murray Buttes|58_2046|8307.80" href="#" shape="poly" coords="2880,2325,3050,2325,3050,2375,2880,2375,2880,2325" data-title="Sebina" data-searchterm="sebina">

    //The second set contains the two scoop sites Rocknest and Gobabeb as detailed by the yellow dots
    <area class="clickable" data-zone="Bradbury Landing to Glenelg Intrigue|5_104|397.72" href="#" shape="poly" coords="2720,400,2950,400,2950,450,2720,450,2720,400" data-title="Rocknest" data-searchterm="rocknest">
    <area class="clickable" data-zone="Namib Dune|(None listed?)|(None listed?)" href="#" shape="poly" coords="2790,2080,3010,2080,3010,2125,2790,2125,2790,2080" data-title="Gobabeb" data-searchterm="gobabeb">

    //The third set contains the two searchable analysis types: drill, or scoop
    <area class="clickable" data-zone="Maybe this|should have its own|popover format?" href="#" shape="poly" coords="1975,770,2300,770,2300,830,1975,830,1975,770" data-title="All Drill Sites" data-searchterm="drill">
    <area class="clickable" data-zone="Maybe this|should have its own|popover format?" href="#" shape="poly" coords="1975,870,2370,870,2370,940,1975,940,1975,870" data-title="All Scoop Sites" data-searchterm="scoop">

    //The fourth set contains the locations as detailed by the travel map's red dots... or maybe this isn't feasible/necessary?
</map>
<!-- The search link appears when one or more items are selected. -->
<div id="search-link"></div>
</body>
</html>
